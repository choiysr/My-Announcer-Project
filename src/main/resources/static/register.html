<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Title</title>
</head>

<body>

    <div class="board">
        <input class="title" type="text" name="title">
        <textarea class="content" name="content" placeholder="입력하세요"></textarea>
        <select class="voiceGender">
            <option value="woman">여성</option>
            <option value="man">남성</option>
        </select>

        <div>
            <select class="year">
                <option value="2019">2019</option>
            </select>
            <select class="month">
                <option value="11">11</option>
            </select>
            <select class="day">
                <option value="04">04</option>
            </select>
        </div>

        <div>
            <select class="hour">
                <option value="16">16</option>
            </select>
            <select class="minute">
                <option value="50">50</option>
            </select>
        </div>


        <button class="preListen">미리듣기</button>
        <button class="submitBtn">submit</button>
    </div>
    <div class="audioArea">
        <audio id="player" controls>
            <source id="sourcelink" src="">
        </audio>
    </div>

    <script src="https://code.jquery.com/jquery-3.4.1.js"
        integrity="sha256-WpOohJOqMqqyKL9FccASB9O0KwACQJpFTUBLTYOVvVU=" crossorigin="anonymous"></script>
    <!--<script src='jquery.ajax-cross-origin.min.js'></script>-->
    <script>

        $(document).ready(function () {

            $(".preListen").on("click", function (e) {
                var str = "";
                console.log($(".voiceGender option:selected").val());
                var jsonData =
                {
                    title: $(".title").val(), content: $(".content").val(),
                    gender: $(".voiceGender option:selected").val()
                };
                $.ajax({
                    url: 'http://localhost:8080/board/prelisten',
                    data: jsonData,
                    type: 'GET',
                    dataType: 'json',
                    success: function (result) {
                        $("#sourcelink").attr('src', "http://localhost:8080/board/" + result[0]);
                        $("#player")[0].load();
                        $("#sourcelink").attr("filename", result[0]);
                        /*$("#player").play(); 즉시재생*/
                    }
                }); // end of ajax

            }); //end of button event


            $(".submitBtn").on("click", function (e) {
                var str = "";
                var startdate = $(".year option:selected").val() + "-" + $(".month option:selected").val() + "-" + $(".day option:selected").val()
                var starttime = $(".hour option:selected").val() + ":" + $(".minute option:selected").val()
                var title = $(".title").val() + ""
                var content = $(".content").val() + ""
                var gender = $(".voiceGender option:selected").val()
                console.log($("#sourcelink").attr("filename"));
                var jsonData = {
                    content: content,
                    title: title,
                    gender: gender,
                    startdate: startdate,
                    starttime: starttime,
                    audioName: $("#sourcelink").attr("filename")
                };

                console.log(jsonData)
                $.ajax({
                    url: 'http://localhost:8080/board/register',
                    data: JSON.stringify(jsonData),
                    type: 'POST',
                    contentType: "application/json; charset=utf-8"
                }); // end of ajax

            }); //end of button event



        });
    </script>

</body>

</html>